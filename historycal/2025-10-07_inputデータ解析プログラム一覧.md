# inputディレクトリを解析するプログラムとロジック一覧

**作成日**: 2025-10-07

## 1. **Click_Download.py** - データダウンロード
- **役割**: FXヒストリカルデータをダウンロードしてinputフォルダに保存
- **ロジック**:
  - Playwrightでクリック証券にログイン (16行目)
  - 過去12ヶ月分のデータを自動ダウンロード (30-35行目)
  - 通貨ペアごとにZIPファイルを`input/`に保存 (86-100行目)
  - 対応通貨: USDJPY, EURJPY, GBPJPY, AUDJPY, EURUSD (92-98行目)

## 2. **fx_analysis_step1.py** - FX短期分析
- **役割**: ZIPファイルから1-15分保有の分析を実行
- **入力データ処理** (87-122行目):
  - `input/`フォルダのZIPファイルを走査 (89行目)
  - ZIP内のCSVを直接読み込み (92-99行目: `zipfile.ZipFile`)
  - Shift_JIS エンコーディングでCSV解析 (99行目)
  - 通貨ペアを自動判別 (104行目: ファイル名から抽出)
  - 最終分析日以降の増分データのみ抽出 (101-102行目)
  - 日時列をインデックス化して高速検索 (117行目)
- **分析ロジック** (130-156行目):
  - 全時間帯×保有期間(1-15分)×方向(HIGH/LOW)の組み合わせ分析
  - pips計算: JPYペアは100倍、その他は10000倍 (124-128行目)
  - 730日分のヒストリカルデータ保持 (174-179行目)

## 3. **fx_base_analysis.py** - FX詳細分析
- **役割**: ショートターム(1-15分)とロングターム(1-120分)の両方を分析
- **入力データ処理** (88-122行目):
  - ZIPファイルから直接CSVを読み込み (94-99行目)
  - 通貨ペア自動判別 (105行目)
  - 時系列インデックス化 (117行目: `set_index('日時')`)
  - 増分データのみ処理 (102行目: `df['日時'].dt.date > last_analyzed_date`)
- **2つの分析モード**:
  - ショートターム: 全時刻×1-15分保有 (307-337行目)
  - ロングターム: BO業者満期時刻を終点に1-120分保有 (339-413行目)
- **並列処理**: ProcessPoolExecutorで通貨ペア別並列分析 (321-333行目, 386-409行目)

## 4. **bo_analysis_step1.py** - バイナリーオプション分析
- **役割**: 既存の分析結果(pickle)からBO業者条件に合致するデータを抽出
- **ロジック** (161-191行目):
  - `output/analysis_results.pkl`から事前計算済みデータを読み込み (163行目)
  - 業者の満期時刻と受付時間をチェック (183-188行目)
  - 満期時刻と判定時刻が一致する組み合わせのみフィルタ (187行目)
  - BO業者設定は`config/bo_brokers.json`から取得 (141行目)

## 5. **fx_backtest.py** - バックテストシステム
- **役割**: エントリーポイントとヒストリカルデータでバックテスト実行
- **入力データ処理**:
  - `input/`フォルダのZIPファイルを解析
  - ストップロス・テイクプロフィット機能付き (69-72行目)
  - 通貨ペア設定で自動pip値計算 (74-87行目)
  - 時系列データ監視でSL/TP判定 (159-200行目)

## 主要なデータフロー

```
Click_Download.py
    ↓ (ZIPダウンロード)
input/
    ├── USDJPY_202501.zip
    ├── EURJPY_202501.zip
    └── ...
    ↓
fx_base_analysis.py (基本分析)
    ↓ (pickle保存)
output/analysis_results_15m.pkl
output/analysis_results_120m.pkl
    ↓
bo_analysis_step1.py (BO条件フィルタ)
    ↓
output/bo_analysis/*.csv
```

## 共通処理パターン

1. **ZIPファイル読み込み**: `zipfile.ZipFile()` + 直接CSV読み込み
2. **エンコーディング**: Shift_JIS (クリック証券データ)
3. **通貨ペア判別**: ファイル名から自動抽出 (`*.split('_')[0]`)
4. **日時処理**: `pd.to_datetime()` + インデックス化で高速検索
5. **増分更新**: 最終分析日以降のデータのみ処理
6. **結果保存**: pickleでキャッシュ、CSVで最終出力

## inputフォルダのデータ構成

- **通貨ペア**: USDJPY, EURJPY, GBPJPY, AUDJPY, EURUSD
- **期間**: 過去12ヶ月分（月次ZIPファイル）
- **形式**: ZIPアーカイブ内にCSVファイル（Shift_JISエンコード）
- **更新頻度**: 自動ダウンロードスクリプトで定期更新
